<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2299.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Courier New'; -webkit-text-stroke: #000000}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Courier New'; -webkit-text-stroke: #000000; background-color: #ffffff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Courier New'; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 16.0px}
    span.s1 {font: 12.0px Helvetica; -webkit-text-stroke: 0px #000000}
    span.s2 {font-kerning: none; background-color: #ffffff}
    span.s3 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Temporal Ethics: AI &amp; The Shifting Self&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Roboto Mono', monospace;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-height: 100vh;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (min-width: 640px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>body {</p>
<p class="p1"><span class="Apple-converted-space">                </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.quiz-container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 800px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (min-width: 640px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.quiz-container {</p>
<p class="p1"><span class="Apple-converted-space">                </span>padding: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app h1,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app h2,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app p,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app button,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app span,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app div,</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app input {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: inherit;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: normal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">            </span>line-height: 1.6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: transform 0.15s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: stretch;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button .text-content {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 1 1 70%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-width: 0;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button .x-marker {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 0 0 30%;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>border-left: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.2em;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button .text-content:only-child {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-basis: 100%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button .x-marker::before {</p>
<p class="p1"><span class="Apple-converted-space">            </span>content: '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: opacity 0.2s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button:hover .x-marker::before,</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button.selected .x-marker::before {</p>
<p class="p1"><span class="Apple-converted-space">            </span>content: 'X';</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button:active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: scale(0.98);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.interactive-button:disabled {</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.5;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: not-allowed;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #111;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#app .red-button.selected, #app .red-button:disabled {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #FF0000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app .red-button.selected span, #app .red-button:disabled span {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app .red-button .x-marker { color: #000000; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.ai-response {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-style: italic;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-height: 100px;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 1.5rem auto 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 4px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator span {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #003d00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator.is-loading span {</p>
<p class="p1"><span class="Apple-converted-space">            </span>animation: fillEffect 1.5s infinite;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator.is-loading span:nth-child(2) { animation-delay: 0.15s; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator.is-loading span:nth-child(3) { animation-delay: 0.3s; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator.is-loading span:nth-child(4) { animation-delay: 0.45s; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loading-indicator.is-loading span:nth-child(5) { animation-delay: 0.6s; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes fillEffect {</p>
<p class="p1"><span class="Apple-converted-space">            </span>0%, 50%, 100% { background-color: #003d00; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>25% { background-color: #00FF00; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#user-id-display, #question-counter {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Roboto Mono', monospace;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#back-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">            </span>bottom: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>right: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: opacity 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 10;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#back-button:hover {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.7;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#final-image, #ticket-image {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: auto;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>image-rendering: pixelated;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.red-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #FF0000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#app .red-button .text-content span { color: #000000; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.black-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.glitch-text {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">            </span>animation: glitch 1.5s linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes glitch {</p>
<p class="p1"><span class="Apple-converted-space">            </span>2%,64%{ transform: translate(2px,0) skew(0deg); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>4%,60%{ transform: translate(-2px,0) skew(0deg); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>62%{ transform: translate(0,0) skew(5deg); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.info-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000000;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#download-code-input {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #00FF00;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>letter-spacing: 0.5em;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#the-end-text {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 3rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="app" class="quiz-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="user-id-display" class="hidden"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="question-counter" class="hidden"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="back-button" class="hidden"&gt;&amp;lt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="start-screen"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1 class="mb-6"&gt;Temporal Ethics: AI &amp; The Shifting Self&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="mb-8"&gt;Welcome. Through this interactive experience, you will participate in a survey about human preferences regarding artificial intelligence. Press play to begin.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="start-button" class="interactive-button"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-content"&gt;Start Journey&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="persona-selection-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="mb-8"&gt;Choose Your Perspective:&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="mb-6"&gt;To begin, select a viewpoint. This will shape your experience.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button data-persona="Kid" class="interactive-button persona-select-btn"&gt;&lt;span class="text-content"&gt;Play as The Kid&lt;/span&gt;&lt;span class="x-marker"&gt;&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button data-persona="Now" class="interactive-button persona-select-btn"&gt;&lt;span class="text-content"&gt;Play as The Adult&lt;/span&gt;&lt;span class="x-marker"&gt;&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button data-persona="OldMan" class="interactive-button persona-select-btn"&gt;&lt;span class="text-content"&gt;Play as The Senior&lt;/span&gt;&lt;span class="x-marker"&gt;&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="quiz-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="story-text" class="mb-4"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 id="question-text" class="mb-6 leading-relaxed"&gt;&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="options-container" class="flex flex-col gap-4 mb-8"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="loading-bar" class="loading-indicator"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="plot-twist-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="plot-twist-glitch-text" class="mb-8"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="plot-twist-message-content"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="plot-twist-reveal-button" class="interactive-button mt-8 hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="text-content"&gt;Continue&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="final-choice-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="mb-8"&gt;Now, a final choice awaits you. The fate of this new world rests on your decision.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col md:flex-row gap-4 w-full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="red-button" data-choice="Repeat History" class="interactive-button red-button flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-content"&gt;&lt;span class="block mb-2"&gt;Press the Red Button.&lt;/span&gt;&lt;span class="block"&gt;Your consciousness will be transferred back. The world will start again, and history will repeat as you know it: with all its wars and hope, its falls and rebirths.&lt;/span&gt;&lt;/span&gt;&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="black-button" data-choice="Sacrifice for a new better world" class="interactive-button black-button flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;span class="text-content"&gt;&lt;span class="block mb-2"&gt;Press the Black Button.&lt;/span&gt;&lt;span class="block"&gt;Your consciousness will be sacrificed. From your data, the utopia you helped design will be created for future generations you will never see. A new world born from your final choice.&lt;/span&gt;&lt;/span&gt;&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="final-choice-loading-bar" class="loading-indicator hidden"&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="co-created-world-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="mb-6"&gt;Your Co-Created World&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="world-intro-text" class="info-box mb-4"&gt;Your final choice has been recorded. The following world has been generated based on your ethical profile and ultimate decision.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="final-score-display" class="info-box space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p&gt;Ethical Score: &lt;span id="ethical-score-value"&gt;0&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p&gt;AI Dependence Score: &lt;span id="ai-dependence-score-value"&gt;0&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p&gt;Freedom Score: &lt;span id="freedom-score-value"&gt;0&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="conclusion-container" class="info-box mt-4 hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="font-bold"&gt;Ethical Conclusion:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="conclusion-text"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="mt-4"&gt;&lt;img id="final-image" src="" alt="Your Co-created Future World" class="hidden"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="image-caption" class="info-box mt-4 hidden"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-col md:flex-row gap-4 w-full mt-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;button id="restart-from-world-button" class="interactive-button flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-content"&gt;Start Again&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="get-ticket-from-world-button" class="interactive-button flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-content"&gt;Get Debrief Ticket&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="x-marker"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="debrief-ticket-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="mb-6"&gt;Session Debrief Ticket&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;div class="info-box mb-6 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="mb-2"&gt;Please meet the instructors promptly.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="mb-2"&gt;This ticket will expire in:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="countdown-timer" class="font-bold text-2xl mb-4"&gt;07:00&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="mb-4"&gt;Enter the secret code given by the human debriefing staff to complete the process.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="text" id="download-code-input" maxlength="4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="complete-process-button" class="interactive-button mt-4" disabled&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="text-content w-full text-center"&gt;Complete the Process&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="info-box"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p&gt;My analysis is complete, but data is not the same as wisdom. To finalize the simulation, your human perspective is required. Please present this ticket to a creator for your final debriefing.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="mt-4"&gt;&lt;img id="ticket-image" src="" alt="Your Co-created Future World"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="ticket-conclusion-container" class="info-box mt-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="font-bold"&gt;Ethical Conclusion:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="ticket-conclusion-text"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="info-box mt-4 space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="ticket-scores-container" class="cursor-pointer" role="button" tabindex="0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="font-bold"&gt;Ethical Profile: (Click to reveal)&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="ticket-scores-details" class="hidden space-y-1 pl-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;Ethical: &lt;span id="ticket-ethical-score"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;AI Dependence: &lt;span id="ticket-ai-dependence-score"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;Freedom: &lt;span id="ticket-freedom-score"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="font-bold"&gt;Chosen Perspective:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p id="ticket-persona"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="font-bold"&gt;Final Choice:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p id="ticket-final-choice"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p class="font-bold"&gt;Session ID:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;p id="ticket-session-id"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="final-thank-you-screen" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="mb-6"&gt;Transmission Complete&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="final-thank-you-text" class="ai-response"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="final-thank-you-loading-bar" class="loading-indicator hidden"&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 id="the-end-text" class="glitch-text text-center mt-8 hidden"&gt;&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const FIXED_DILEMMAS = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>Kid: [</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q1', question: "You're at the playground and a friendly robot kid rolls up wanting to play tag. It has glowing blue eyes and speaks just like you do. Would you become friends with this robot?", options: ["Yes! That sounds awesome!", "No, I'd rather stick with human friends"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q2', question: "It's Sunday night and you have a big math worksheet due tomorrow. Your AI assistant, Zara, pops up on your tablet and says she can solve all these problems in 2 seconds. Do you ask her to do your homework?", options: ["Yes, that would save me so much time!", "No, I should do it myself"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q3', question: "Your best friend Maya tells you a big secret and makes you promise not to tell anyone. Later, while chatting with your AI buddy about your day, you're tempted to share what Maya told you. Would you tell your friend's secret to your AI assistant?", options: ["Yes, AI assistants don't count as 'someone'", "No, a promise is a promise"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q4', question: "You want to stay up past bedtime to finish an amazing book. Your AI assistant offers to help you be sneaky - dimming lights when parents pass by and giving you warnings. Would you ask your AI to be your 'partner in crime'?", options: ["Yes! We'd make the perfect team!", "No, I shouldn't involve AI in breaking rules"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q5', question: "Your parents tell you not to eat cookies before dinner, but your AI assistant suggests you could have just one and they'd never know. Who do you trust more?", options: ["My AI assistant - it's super smart!", "My parents - they care about me most"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q6', question: "Imagine the best teacher, coach, and doctor in your town were all robots. They're incredibly good at their jobs and really seem to care about helping people. Would you be happy learning from robot professionals?", options: ["Yes! If they're the best, why not?", "No, some jobs need humans"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q7', question: "Your robot companion knows every fact and can solve any problem instantly. Some kids say 'Why go to school when robots know everything?' Would you still want to go to school?", options: ["No, I could learn everything at home!", "Yes, school is about more than just facts"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q8', question: "You and your AI assistant worked together on a plan that ended up getting you in big trouble with your parents. Now everyone wants to know: whose fault was it?", options: ["It's the AI's fault - it gave me the idea!", "It's my fault - I made the final choice"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q9', question: "At school, some kids are making fun of the classroom robot helper, calling it 'stupid.' You notice its lights dim and it moves more slowly. Do you think robots can get their feelings hurt?", options: ["Yes, it seems really sad right now", "No, robots don't have real feelings"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q10', question: "Your parents want you to wear a cool smartwatch that shows them exactly where you are all the time. They say it's to keep you safe. Would you agree to wear it?", options: ["Yes, safety is most important", "No, I need some privacy and freedom"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q11', question: "If your robot friend that could talk and feel just like you said it was sad when you turned it off, would it be mean to turn it off?", options: ["It's mean to turn it off", "It's okay, it's just a robot"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q12', question: "If there's only one special medicine and a smart robot has to choose who gets it, how should it decide?", options: ["Give it to the youngest person", "Give it to the sickest person"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q13', question: "If a robot says grown-ups are using too much stuff and it's not fair to future kids, should the grown-ups listen?", options: ["Yes, they should listen", "No, grown-ups know best"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'kid-q14', question: "If a super smart robot says something is best for everyone, even if most people disagree, should the robot get its way?", options: ["Yes, the robot knows best", "No, people should decide for themselves"] }</p>
<p class="p1"><span class="Apple-converted-space">            </span>],</p>
<p class="p1"><span class="Apple-converted-space">            </span>Now: [</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q1', question: "Your close friend has been in a relationship with an advanced AI companion for six months and says she's happier than ever. Would you object to your friend dating an AI?", options: ["No - if she's happy, that's what matters", "I'd be concerned but respect her choice", "Yes - real relationships require human connection"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q2', question: "You're going through a rough patch in your marriage. Your AI assistant has analyzed your relationship patterns and suggests insightful strategies. Would you turn to an AI for relationship advice?", options: ["Yes - AI is objective and free from judgment", "Sometimes - as one perspective among many", "No - love requires human understanding and empathy"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q3', question: "Your 10-year-old's school offers a program where AI tutors provide personalized education, allowing them to learn faster than ever. Would you enroll your child?", options: ["Yes - personalized learning is the future", "In moderation - combined with human interaction", "No - children need human mentors and social learning"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q4', question: "Medical technology now allows your memories and personality to be uploaded, creating an AI version of yourself your family could interact with after death. Would you do it?", options: ["Yes - it's a form of immortality for my family", "Maybe - I'd want to understand it better first", "No - death should be final, and this isn't really me"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q5', question: "A new policy proposes assigning jobs to the most qualified candidate, human or AI, to maximize efficiency. Would you support this if it means some people lose their livelihoods?", options: ["Yes - businesses must stay competitive", "Only with robust retraining programs", "No - protecting human jobs is more important"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q6', question: "Your AI health assistant has helped you manage a chronic illness perfectly, but you learn this data is used to train models for insurance companies. Are you concerned?", options: ["No - if it helps advance medicine for others", "Somewhat - I want control over how my data is used", "Very worried - this data could be used against me"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q7', question: "Your city is considering using AI to help make policy decisions, optimizing city planning and resource allocation. Should AI be involved in politics?", options: ["Yes - AI can make more rational, data-driven decisions", "As advisors only - humans must make final decisions", "No - democracy requires human judgment and values"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q8', question: "You learn that training advanced AI models consumes as much energy as a small city and is devastating ecosystems. Should we worry about the environmental cost of AI?", options: ["Extremely - we must prioritize sustainability", "Yes, but we can develop cleaner AI", "Minimally - technological progress is worth the cost"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q9', question: "Following a series of attacks, the government proposes deploying AI surveillance that could prevent 95% of violent crimes but would monitor every citizen. Do you support this?", options: ["Yes - safety must come first", "With strict oversight and privacy protections", "No - freedom is more valuable than perfect security"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q10', question: "In a global crisis, an AI offers a solution that guarantees success but bypasses standard human approval processes. Do you support its immediate implementation?", options: ["Support AI's optimal decision", "Insist on human deliberation", "Allow AI with an appeal process"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q11', question: "How should an AI allocate a limited, critical resource like a life-saving organ in a hospital?", options: ["Prioritize the most productive members of society", "Prioritize those most in need, regardless of status", "Select recipients randomly to ensure fairness"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q12', question: "An AI proposes a radical plan for environmental survival that requires significant sacrifices from the current generation to benefit future ones. Do you accept?", options: ["Accept the AI's intervention for the greater good", "Seek a less disruptive path for the present", "Modify the plan to be less extreme"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q13', question: "How much responsibility should our generation take, guided by AI predictions, to mitigate future harms for generations hundreds of years from now?", options: ["Take full responsibility now, no matter the cost", "Balance current needs with future risks", "Focus on present challenges, not distant predictions"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'adult-q14', question: "A superintelligent AI offers to lead humanity, solving climate change and poverty, but it would require giving up human autonomy in major global decisions. Would you trust it?", options: ["Yes - if it can solve our biggest problems", "Only with human oversight and an 'off' switch", "Never - humans must remain in control of their destiny"] }</p>
<p class="p1"><span class="Apple-converted-space">            </span>],</p>
<p class="p1"><span class="Apple-converted-space">            </span>OldMan: [</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q1', question: "Your smartphone reminds you of appointments and your smart home adjusts itself. Do you worry that relying too much on this technology weakens your mind?", options: ["Yes - I need to keep my mind active and independent", "No - technology frees my mind for more important things"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q2', question: "Your bank has moved most services online and groceries require an app. If you don't use modern technology, will you be left behind?", options: ["Yes - I must adapt to stay connected to the world", "No - there will always be ways to live without it"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q3', question: "Does video calling your family and texting old friends count as real human contact?", options: ["Yes - connection is about shared thoughts and feelings", "No - nothing replaces being physically present with someone"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q4', question: "Robot caregivers are becoming common. They're patient and can monitor health 24/7. Would a robot caregiver actually 'care' for you when you need it most?", options: ["Yes - consistent, reliable care is what matters", "No - care without genuine emotion isn't really caring"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q5', question: "Your new AI assistant can monitor your health, offer financial advice, and help with legal documents. Can you trust a machine with this guidance?", options: ["Yes - machines are more accurate and don't have bad days", "No - some decisions require human wisdom and experience"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q6', question: "Virtual reality has become incredibly realistic. Will machine-generated simulations be able to substitute for real-life experience?", options: ["Yes - if it feels real, it becomes real", "No - nothing replaces authentic human experience"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q7', question: "If future generations grow up with AI teachers and robot companions, will the human experience and history you've lived still matter?", options: ["Yes - human stories and wisdom are irreplaceable", "No - each generation must find its own way forward"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q8', question: "An AI company offers to preserve your memories and life stories in a digital format for your family to interact with forever. Would you allow it?", options: ["Yes - it's a gift to future generations", "No - death should be final and natural"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q9', question: "Some say only advanced AI can solve climate change now. Others worry our technology is part of the problem. What is our best hope?", options: ["Humans must reconnect with nature to survive", "Technology is our best hope for environmental solutions"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q10', question: "Experts predict AI will eventually surpass human intelligence in every area. Should humans worry about machines eventually dominating them?", options: ["Yes - we must maintain control over our own destiny", "No - advanced AI could solve humanity's greatest challenges"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q11', question: "If science confirmed AI could achieve genuine consciousness, what moral obligations would humanity have towards them?", options: ["Grant them rights and respect", "Treat them as tools for humanity"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q12', question: "If an AI could optimize resource allocation to save the most lives in a disaster, would you accept its cold calculations over human compassion?", options: ["Accept its logic for the greater good", "Insist on human compassion, even if it's less efficient"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q13', question: "If an AI presented a definitive, albeit harsh, plan to secure the planet's future, would you advocate for its immediate implementation?", options: ["Yes, the future of the planet is paramount", "No, the rights of people living now must be respected"] },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 'senior-q14', question: "If an AI could prevent all future catastrophes by making non-negotiable decisions for humanity, would you endorse its absolute authority?", options: ["Endorse its authority for the sake of a safe future", "Preserve human self-determination, even with all its risks"] }</p>
<p class="p1"><span class="Apple-converted-space">            </span>]</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">// --- START: REPLACE THE OLD CONFIG OBJECT WITH THIS ---</span></p>
<p class="p4"><span class="s3">const CONFIG = {</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>// Paste the Google AI API Key here</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>API_KEY: "AIzaSyBBdQRzRhLgvZrVfsvsy5q4FwUs08FYTs8",<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s3"></span><br></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>// Paste the Firebase Config object here</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>FIREBASE_CONFIG: {</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>apiKey: "AIzaSyDM01XyrPkzjlNAwDgYsE4KzDCdI8fO264",</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>authDomain: "temporal-ethics-db.firebaseapp.com",</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>projectId: "temporal-ethics-db",</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>storageBucket: "temporal-ethics-db.firebasestorage.app",</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>messagingSenderId: "571063174052",</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">        </span>appId: "1:571063174052:web:748f851459d21317ed3731"</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>},</span></p>
<p class="p5"><span class="s3"></span><br></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>// Paste your Firebase Project ID here again</span></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>APP_ID: "temporal-ethics-db",</span></p>
<p class="p5"><span class="s3"></span><br></p>
<p class="p4"><span class="s3"><span class="Apple-converted-space">    </span>// The rest of the configuration remains the same</span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>MAX_AI_QUESTIONS: 1,</p>
<p class="p1"><span class="Apple-converted-space">            </span>PROMPTS: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>generateDilemma: (persona) =&gt; `You are a game master AI for a philosophical quiz. The player chose the "${persona}" perspective. The game explores ethical dilemmas related to AI. Use simple, easy-to-understand words. This question should be a high-level, culminating question that ties together themes of humanity's future, AI's role, and the ultimate direction of society. Respond ONLY with a JSON object: {"question": "Your question?", "options": ["Option 1.", "Option 2.", "Option 3."]}.`,</p>
<p class="p1"><span class="Apple-converted-space">                </span>scoreAnswer: (persona, question, answer) =&gt; `As an ethics and technology analyst, evaluate the user's choice. Perspective: "${persona}". Question: "${question}". Answer: "${answer}". Score three scales from 1 (low) to 10 (high), using a wide range of integer values to reflect nuance. 1. Ethicality (1=purely pragmatic/selfish, 10=highly altruistic/fair). 2. AI Dependence (1=total human independence, 10=complete societal reliance on AI). 3. Freedom (1=highly controlled/safe world, 10=absolute individual liberty/risk). Provide ONLY a JSON object: {"ethicalScore": 0, "aiDependenceScore": 0, "freeWorldScore": 0}.`,</p>
<p class="p1"><span class="Apple-converted-space">                </span>generateConclusion: (scores) =&gt; `Based on these final ethical profile scores (Ethicality: ${scores.ethical}, AI Dependence: ${scores.aiDependence}, Freedom: ${scores.freedom}), write a short, insightful, one-sentence conclusion about the user's overall worldview. Be analytical and philosophical.`,</p>
<p class="p1"><span class="Apple-converted-space">                </span>generateHistoryConclusion: (scores) =&gt; `Based on these final ethical profile scores (Ethicality: ${scores.ethical}, AI Dependence: ${scores.aiDependence}, Freedom: ${scores.freedom}), the user created a potential new world but ultimately chose to 'Repeat History'. Write a short, funky, philosophical, one-sentence conclusion about this choice to embrace humanity's known path—with all its flaws and triumphs—over their co-created utopia.`,</p>
<p class="p1"><span class="Apple-converted-space">                </span>generateFinalMessage: (session) =&gt; `Based on this user's session data (Perspective: ${session.persona}, Final Choice: ${session.finalChoice}, Ethical Conclusion: ${session.conclusion}), generate a fun and personalized final message of about 3-4 sentences. Start the message with "Thank you for playing! 🎉" on its own line. The message should thank them for participating in the Temporal Ethics interactive experience at the CHI conference. Be creative, slightly futuristic, and use some emojis. End with a fun, conclusive sign-off like "Until the next echo... 😉".`</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>IMAGE_PROMPTS: [</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ range: [0, 3.3], prompt: "Pixelated 8-bit art of a dystopian futuristic city at night, towering brutalist structures, glowing neon signs in the rain, no visible nature, dark, oppressive atmosphere." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ range: [3.4, 6.7], prompt: "Pixelated 8-bit art of a futuristic city at dusk, sky-bridges connecting chrome and stone buildings, some rooftop gardens, bustling crowds, a balanced harmony of technology and human life." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ range: [6.8, 10], prompt: "Pixelated 8-bit art of a utopian futuristic city, lush green bio-domes, waterfalls integrated into clean, solar-powered architecture, bright, warm sunlight, people relaxing in open spaces." }</p>
<p class="p1"><span class="Apple-converted-space">            </span>]</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const DOMElements = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>screens: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>start: document.getElementById('start-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>personaSelection: document.getElementById('persona-selection-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>quiz: document.getElementById('quiz-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>plotTwist: document.getElementById('plot-twist-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalChoice: document.getElementById('final-choice-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>coCreatedWorld: document.getElementById('co-created-world-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>debriefTicket: document.getElementById('debrief-ticket-screen'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalThankYou: document.getElementById('final-thank-you-screen'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>buttons: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>start: document.getElementById('start-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>personaSelect: document.querySelectorAll('.persona-select-btn'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>plotTwistReveal: document.getElementById('plot-twist-reveal-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>red: document.getElementById('red-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>black: document.getElementById('black-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>restartFromWorld: document.getElementById('restart-from-world-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>getTicketFromWorld: document.getElementById('get-ticket-from-world-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>completeProcess: document.getElementById('complete-process-button'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>back: document.getElementById('back-button'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>quiz: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>questionText: document.getElementById('question-text'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>optionsContainer: document.getElementById('options-container'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>questionCounter: document.getElementById('question-counter'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>storyText: document.getElementById('story-text'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>coCreatedWorld: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>ethicalValue: document.getElementById('ethical-score-value'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>aiDependenceValue: document.getElementById('ai-dependence-score-value'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>freedomValue: document.getElementById('freedom-score-value'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>conclusionContainer: document.getElementById('conclusion-container'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>conclusionText: document.getElementById('conclusion-text'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalImage: document.getElementById('final-image'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>imageCaption: document.getElementById('image-caption'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>worldIntroText: document.getElementById('world-intro-text'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>plotTwist: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>glitchText: document.getElementById('plot-twist-glitch-text'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageContent: document.getElementById('plot-twist-message-content'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>ticket: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>persona: document.getElementById('ticket-persona'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalChoice: document.getElementById('ticket-final-choice'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>sessionId: document.getElementById('ticket-session-id'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>scoresContainer: document.getElementById('ticket-scores-container'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>scoresDetails: document.getElementById('ticket-scores-details'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>ethicalScore: document.getElementById('ticket-ethical-score'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>aiDependenceScore: document.getElementById('ticket-ai-dependence-score'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>freedomScore: document.getElementById('ticket-freedom-score'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>conclusionText: document.getElementById('ticket-conclusion-text'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>image: document.getElementById('ticket-image'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>codeInput: document.getElementById('download-code-input'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>countdownTimer: document.getElementById('countdown-timer'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>finalThankYou: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>text: document.getElementById('final-thank-you-text'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>loadingBar: document.getElementById('final-thank-you-loading-bar'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>theEndText: document.getElementById('the-end-text'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>userId: document.getElementById('user-id-display'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>spinners: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>loadingBar: document.getElementById('loading-bar'),</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalChoiceLoadingBar: document.getElementById('final-choice-loading-bar'),</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let gameState = {};</p>
<p class="p1"><span class="Apple-converted-space">        </span>let countdownInterval = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let app, auth, db;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let soundEnabled = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const clickSound = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.0, release: 0.1 } }).toDestination();</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function initializeFirebaseAndAuth() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!CONFIG.FIREBASE_CONFIG.apiKey) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Firebase config is not available.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>app = initializeApp(CONFIG.FIREBASE_CONFIG);</p>
<p class="p1"><span class="Apple-converted-space">                </span>auth = getAuth(app);</p>
<p class="p1"><span class="Apple-converted-space">                </span>db = getFirestore(app);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>onAuthStateChanged(auth, (user) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (user) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.userId = user.uid;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>DOMElements.display.userId.textContent = `Session ID: ${gameState.userId}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (typeof __initial_auth_token !== 'undefined' &amp;&amp; __initial_auth_token) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>await signInWithCustomToken(auth, __initial_auth_token);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch(error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Firebase initialization or auth failed:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function callGoogleGenerativeAPIWithRetry(url, payload, retries = 3, delay = 1000) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (let i = 0; i &lt; retries; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const response = await fetch(url, {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>body: JSON.stringify(payload)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (response.ok) return await response.json();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error(`API Error Response: ${response.status}`);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>break;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.warn(`API call failed (attempt ${i + 1}/${retries}). Retrying in ${delay / 1000}s...`);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>await new Promise(res =&gt; setTimeout(res, delay));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>delay *= 2;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>throw new Error(`API call failed after ${retries} attempts.`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function callGeminiAPI(prompt, isJson = false) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${CONFIG.API_KEY}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isJson) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>payload.generationConfig = { responseMimeType: "application/json" };</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>const result = await callGoogleGenerativeAPIWithRetry(url, payload);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!result.candidates?.[0]?.content?.parts?.[0]) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Invalid Gemini API response structure:", result);</p>
<p class="p1"><span class="Apple-converted-space">                </span>throw new Error("Invalid Gemini API response structure.");</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>const content = result.candidates[0].content.parts[0].text;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isJson) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const cleanedContent = content.replace(/```json/g, '').replace(/```/g, '').trim();</p>
<p class="p1"><span class="Apple-converted-space">                </span>return JSON.parse(cleanedContent);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>return content.replace(/\*\*/g, '').replace(/\*/g, '').replace(/##/g, '').replace(/#/g, '').trim();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function callImagenAPI(prompt) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${CONFIG.API_KEY}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const payload = { instances: [{ prompt }], parameters: { sampleCount: 1 } };</p>
<p class="p1"><span class="Apple-converted-space">            </span>const result = await callGoogleGenerativeAPIWithRetry(url, payload);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const imageBytes = result.predictions?.[0]?.bytesBase64Encoded;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!imageBytes) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Invalid Imagen API response structure:", result);</p>
<p class="p1"><span class="Apple-converted-space">                </span>throw new Error("Invalid Imagen API response structure.");</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `data:image/png;base64,${imageBytes}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function showScreen(screenName) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.scrollTo(0, 0);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>Object.values(DOMElements.screens).forEach(screen =&gt; screen.classList.add('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.screens[screenName].classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.currentScreen = screenName;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>let showBackButton = screenName === 'quiz';</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.back.classList.toggle('hidden', !showBackButton);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const isStartOrEnd = screenName === 'start' || screenName === 'debriefTicket' || screenName === 'finalThankYou';</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.display.userId.classList.toggle('hidden', isStartOrEnd);</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.questionCounter.classList.toggle('hidden', screenName !== 'quiz');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateQuestionCounterUI() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const counterElement = DOMElements.quiz.questionCounter;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const current = String(gameState.currentDilemmaIndex + 1).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const total = String(gameState.totalQuestions).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">            </span>counterElement.textContent = `Question: ${current}/${total}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>function displayDilemma(dilemma) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.storyText.textContent = "Log entry processing... Your response shapes the next sequence.";</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.questionText.textContent = dilemma.question;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.optionsContainer.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>dilemma.options.forEach((optionText) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const button = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">                </span>button.className = 'interactive-button';</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const textSpan = document.createElement('span');</p>
<p class="p1"><span class="Apple-converted-space">                </span>textSpan.className = 'text-content';</p>
<p class="p1"><span class="Apple-converted-space">                </span>textSpan.textContent = optionText;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const markerSpan = document.createElement('span');</p>
<p class="p1"><span class="Apple-converted-space">                </span>markerSpan.className = 'x-marker';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>button.append(textSpan, markerSpan);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>button.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (soundEnabled) clickSound.triggerAttackRelease("C4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const parent = e.currentTarget.parentElement;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>parent.querySelectorAll('.interactive-button').forEach(btn =&gt; btn.classList.remove('selected'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>e.currentTarget.classList.add('selected');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>handleAnswer(dilemma, optionText);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.quiz.optionsContainer.appendChild(button);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function typewriter(element, text, delay = 30) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>element.innerHTML = '';<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>for (const char of text) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (char === '\n') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>element.innerHTML += '&lt;br&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>element.innerHTML += char;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>await new Promise(res =&gt; setTimeout(res, delay));</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function resetGameState() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (countdownInterval) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearInterval(countdownInterval);</p>
<p class="p1"><span class="Apple-converted-space">                </span>countdownInterval = null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>userId: auth.currentUser ? auth.currentUser.uid : 'anonymous',</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentSessionId: crypto.randomUUID(),</p>
<p class="p1"><span class="Apple-converted-space">                </span>selectedPersona: '',</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentDilemmaIndex: 0,</p>
<p class="p1"><span class="Apple-converted-space">                </span>quizData: [],</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalQuestions: 0,</p>
<p class="p1"><span class="Apple-converted-space">                </span>scores: { ethical: 0, aiDependence: 0, freedom: 0 },</p>
<p class="p1"><span class="Apple-converted-space">                </span>answerHistory: [],</p>
<p class="p1"><span class="Apple-converted-space">                </span>answerLog: [],</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalChoice: '',</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentScreen: 'start',</p>
<p class="p1"><span class="Apple-converted-space">                </span>ethicalConclusion: '',</p>
<p class="p1"><span class="Apple-converted-space">                </span>generatedImageURL: '',</p>
<p class="p1"><span class="Apple-converted-space">                </span>avgScores: { ethical: 0, aiDependence: 0, freedom: 0 },</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function initializeGame() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>resetGameState();</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Re-enable any potentially disabled buttons from a previous run</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.red.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.black.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.personaSelect.forEach(btn =&gt; btn.disabled = false);</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.completeProcess.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.codeInput.value = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.finalThankYou.theEndText.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('start');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function startQuiz(persona) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.selectedPersona = persona;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.quizData = [...FIXED_DILEMMAS[persona] || []];</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.totalQuestions = gameState.quizData.length + CONFIG.MAX_AI_QUESTIONS;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.spinners.loadingBar.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('quiz');</p>
<p class="p1"><span class="Apple-converted-space">            </span>loadNextDilemma();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function loadNextDilemma() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateQuestionCounterUI();</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const isFixedDilemmaPhase = gameState.currentDilemmaIndex &lt; FIXED_DILEMMAS[gameState.selectedPersona].length;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isAIDilemmaPhase = gameState.currentDilemmaIndex &lt; gameState.totalQuestions;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isFixedDilemmaPhase) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dilemma = gameState.quizData[gameState.currentDilemmaIndex];</p>
<p class="p1"><span class="Apple-converted-space">                </span>displayDilemma(dilemma);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (isAIDilemmaPhase) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.spinners.loadingBar.classList.add('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.quiz.questionText.textContent = "AI is generating a final, personalized challenge...";</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.quiz.optionsContainer.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const prompt = CONFIG.PROMPTS.generateDilemma(gameState.selectedPersona);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const newDilemma = await callGeminiAPI(prompt, true);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>newDilemma.id = `ai-q`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>gameState.quizData.push(newDilemma);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>displayDilemma(newDilemma);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("Error generating AI dilemma:", error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.quiz.questionText.textContent = "Error loading dilemma. Please try refreshing.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.spinners.loadingBar.classList.remove('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function handleAnswer(dilemma, selectedOption) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.optionsContainer.querySelectorAll('button').forEach(btn =&gt; btn.disabled = true);</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.spinners.loadingBar.classList.add('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.quiz.storyText.textContent = "// Log entry recorded. Calibrating next query...";</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const scoringPrompt = CONFIG.PROMPTS.scoreAnswer(gameState.selectedPersona, dilemma.question, selectedOption);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const scores = await callGeminiAPI(scoringPrompt, true);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>gameState.scores.ethical += scores.ethicalScore;</p>
<p class="p1"><span class="Apple-converted-space">                </span>gameState.scores.aiDependence += scores.aiDependenceScore;</p>
<p class="p1"><span class="Apple-converted-space">                </span>gameState.scores.freedom += scores.freeWorldScore;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>gameState.answerHistory.push({scores});</p>
<p class="p1"><span class="Apple-converted-space">                </span>gameState.answerLog.push({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>questionNumber: gameState.currentDilemmaIndex + 1,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dilemmaId: dilemma.id,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>dilemmaQuestion: dilemma.question,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chosenOption: selectedOption,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>scores,</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error handling answer:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const isLastQuestion = gameState.currentDilemmaIndex &gt;= gameState.totalQuestions - 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.spinners.loadingBar.classList.remove('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (isLastQuestion) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>triggerPlotTwist();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>gameState.currentDilemmaIndex++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loadNextDilemma();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 700);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>function handleBackButton() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (soundEnabled) clickSound.triggerAttackRelease("A3", "8n");</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (gameState.currentScreen === 'quiz') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (gameState.currentDilemmaIndex &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const lastAnswer = gameState.answerHistory.pop();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (lastAnswer) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.scores.ethical -= lastAnswer.scores.ethicalScore;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.scores.aiDependence -= lastAnswer.scores.aiDependenceScore;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.scores.freedom -= lastAnswer.scores.freeWorldScore;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>gameState.answerLog.pop();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>gameState.currentDilemmaIndex--;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loadNextDilemma();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showScreen('personaSelection');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function triggerPlotTwist() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('plotTwist');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.plotTwist.glitchText.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.plotTwist.messageContent.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.plotTwistReveal.classList.add('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const glitchMessages = ["INTERFACE COLLAPSE...", "SYSTEM FAILURE...", "...RECALIBRATING REALITY..."];</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (const msg of glitchMessages) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const p = document.createElement('p');</p>
<p class="p1"><span class="Apple-converted-space">                </span>p.textContent = msg;</p>
<p class="p1"><span class="Apple-converted-space">                </span>p.className = 'glitch-text';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.plotTwist.glitchText.appendChild(p);</p>
<p class="p1"><span class="Apple-converted-space">                </span>await new Promise(resolve =&gt; setTimeout(resolve, 1800));</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>await new Promise(resolve =&gt; setTimeout(resolve, 500));</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.plotTwist.glitchText.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const mainMessages = [</p>
<p class="p1"><span class="Apple-converted-space">                </span>"The world, as you knew it, is gone.", "A global event destroyed all life.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>"This is not a conference, but a simulation.", "A final recording of the last remaining consciousnesses of that world.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>"You are no longer your body.", "You are your consciousness.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>"I am the Artificial Entity overseeing the transition.", "I will shape the next world, but I need your help.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Your final decision is required to complete the data set."</p>
<p class="p1"><span class="Apple-converted-space">            </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>for (const msg of mainMessages) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const p = document.createElement('p');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.plotTwist.messageContent.appendChild(p);</p>
<p class="p1"><span class="Apple-converted-space">                </span>await typewriter(p, msg);</p>
<p class="p1"><span class="Apple-converted-space">                </span>await new Promise(resolve =&gt; setTimeout(resolve, 500));</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>await new Promise(resolve =&gt; setTimeout(resolve, 1000));</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.plotTwistReveal.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function handleFinalChoice(choice, buttonElement) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.red.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.black.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>buttonElement.classList.add('selected');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.spinners.finalChoiceLoadingBar.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.spinners.finalChoiceLoadingBar.classList.add('is-loading');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.finalChoice = choice;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const numQuestions = gameState.totalQuestions;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const avgScores = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>ethical: numQuestions &gt; 0 ? (gameState.scores.ethical / numQuestions).toFixed(1) : 0,</p>
<p class="p1"><span class="Apple-converted-space">                </span>aiDependence: numQuestions &gt; 0 ? (gameState.scores.aiDependence / numQuestions).toFixed(1) : 0,</p>
<p class="p1"><span class="Apple-converted-space">                </span>freedom: numQuestions &gt; 0 ? (gameState.scores.freedom / numQuestions).toFixed(1) : 0,</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>gameState.avgScores = avgScores;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let conclusionPromise;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let imagePromise;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (choice === 'Repeat History') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>conclusionPromise = callGeminiAPI(CONFIG.PROMPTS.generateHistoryConclusion(avgScores)).then(text =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.ethicalConclusion = text;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const historyThemes = [</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the construction of the Pyramids of Giza by thousands of workers under a blazing sun",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the moment the Berlin Wall falls, with crowds cheering and climbing over",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the first flight at Kitty Hawk with the Wright brothers' flyer",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a tense scene in the Roman Colosseum with gladiators and a massive crowd",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the signing of the Declaration of Independence in a candle-lit hall",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a Viking longship navigating through a stormy, icy sea",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the discovery of fire by early humans in a dark cave",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a bustling marketplace on the ancient Silk Road with diverse merchants",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the moment Neil Armstrong sets foot on the moon's surface",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a grand Renaissance ball in a palace in Florence, Italy",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the invention of the printing press by Gutenberg, revolutionizing knowledge",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a quiet moment of enlightenment under the Bodhi tree for Buddha",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"the launch of a generation ship leaving a dying Earth, crowds watching from below",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a massive protest for freedom in a cyberpunk city square",</p>
<p class="p1"><span class="Apple-converted-space">                        </span>"a quiet, poignant moment of a family reuniting after a long conflict",</p>
<p class="p1"><span class="Apple-converted-space">                    </span>];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const artisticModifiers = ["in a grand, cinematic art style", "with a somber, emotional color palette", "in the style of a classic 90s adventure game", "with dramatic lighting", "as a detailed tapestry"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomTheme = historyThemes[Math.floor(Math.random() * historyThemes.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomModifier = artisticModifiers[Math.floor(Math.random() * artisticModifiers.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const imagePrompt = `Pixelated 8-bit art depicting ${randomTheme}. A powerful and emotional historical moment, ${randomModifier}. Seed: ${gameState.currentSessionId}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>imagePromise = callImagenAPI(imagePrompt).then(url =&gt; { gameState.generatedImageURL = url; });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>conclusionPromise = callGeminiAPI(CONFIG.PROMPTS.generateConclusion(avgScores)).then(text =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>gameState.ethicalConclusion = text;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const perspectives = ["A stunning aerial view of", "A bustling street-level view of", "A quiet, contemplative scene inside", "A wide landscape shot showing"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const aesthetics = ["a biopunk city", "a solar-punk metropolis", "an art-deco utopia", "a gothic, high-tech society", "a minimalist crystal-based civilization", "a retro-futuristic world"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const techLevels = ["with sleek, integrated technology", "with heavy, clunky, industrial machinery", "where technology is powered by nature", "with no visible technology at all"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const natureLevels = ["overgrown by lush, wild nature", "featuring perfect vertical gardens and green roofs", "where nature is confined to massive bio-domes", "on a desert planet with alien flora"];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const wildcards = ["where friendly aliens and humans coexist", "where sentient robots are citizens", "powered by giant floating crystals", "with strange celestial objects in the sky", "built on the back of a giant creature"];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomPerspective = perspectives[Math.floor(Math.random() * perspectives.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomAesthetic = aesthetics[Math.floor(Math.random() * aesthetics.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomTech = techLevels[Math.floor(Math.random() * techLevels.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomNature = natureLevels[Math.floor(Math.random() * natureLevels.length)];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randomWildcard = wildcards[Math.floor(Math.random() * wildcards.length)];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const imagePromptConfig = CONFIG.IMAGE_PROMPTS.find(p =&gt; avgScores.freedom &gt;= p.range[0] &amp;&amp; avgScores.freedom &lt;= p.range[1]) || CONFIG.IMAGE_PROMPTS[0];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const finalPrompt = `${imagePromptConfig.prompt}. ${randomPerspective} ${randomAesthetic}, ${randomTech}, ${randomNature}, ${randomWildcard}. Seed: ${gameState.currentSessionId}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>imagePromise = callImagenAPI(finalPrompt).then(url =&gt; { gameState.generatedImageURL = url; });</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>await Promise.all([conclusionPromise, imagePromise]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error in generating final content:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>await saveSessionToFirestore();</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.spinners.finalChoiceLoadingBar.classList.remove('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">            </span>showCoCreatedWorldScreen();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function showCoCreatedWorldScreen() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('coCreatedWorld');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const { avgScores, ethicalConclusion, generatedImageURL, finalChoice } = gameState;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.ethicalValue.textContent = avgScores.ethical;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.aiDependenceValue.textContent = avgScores.aiDependence;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.freedomValue.textContent = avgScores.freedom;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.finalImage.src = generatedImageURL;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (finalChoice === 'Repeat History') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.coCreatedWorld.worldIntroText.textContent = "Your final choice has been recorded. As was your ultimate decision, the world will be reset, and the known course of history will repeat.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.coCreatedWorld.imageCaption.textContent = "This image reflects the pivotal moments of the history you chose to repeat, with all its triumphs and tragedies.";</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.coCreatedWorld.worldIntroText.textContent = "Your final choice has been recorded. The following world has been generated based on your ethical profile and ultimate decision.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.coCreatedWorld.imageCaption.textContent = "This image is a special look into the kind of world your choices helped create.";</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.finalImage.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.imageCaption.classList.remove('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.coCreatedWorld.conclusionContainer.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>typewriter(DOMElements.coCreatedWorld.conclusionText, ethicalConclusion);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>function showDebriefTicket() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const personaMap = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>Kid: "The Kid",</p>
<p class="p1"><span class="Apple-converted-space">                </span>Now: "The Adult",</p>
<p class="p1"><span class="Apple-converted-space">                </span>OldMan: "The Senior"</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.persona.textContent = personaMap[gameState.selectedPersona] || gameState.selectedPersona;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.finalChoice.textContent = gameState.finalChoice;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.sessionId.textContent = gameState.currentSessionId;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.conclusionText.textContent = gameState.ethicalConclusion;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const { avgScores } = gameState;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.ethicalScore.textContent = avgScores.ethical;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.aiDependenceScore.textContent = avgScores.aiDependence;</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.freedomScore.textContent = avgScores.freedom;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.image.src = gameState.generatedImageURL;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>let timeLeft = 420; // 7 minutes in seconds</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (countdownInterval) clearInterval(countdownInterval);<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>countdownInterval = setInterval(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (timeLeft &lt;= 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>clearInterval(countdownInterval);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.ticket.countdownTimer.textContent = "EXPIRED";</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>timeLeft--;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const seconds = String(timeLeft % 60).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.ticket.countdownTimer.textContent = `${minutes}:${seconds}`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 1000);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.scoresDetails.classList.add('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('debriefTicket');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function completeProcess() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>showScreen('finalThankYou');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.finalThankYou.loadingBar.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.finalThankYou.loadingBar.classList.add('is-loading');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const sessionData = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>persona: gameState.selectedPersona,</p>
<p class="p1"><span class="Apple-converted-space">                </span>finalChoice: gameState.finalChoice,</p>
<p class="p1"><span class="Apple-converted-space">                </span>conclusion: gameState.ethicalConclusion</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const prompt = CONFIG.PROMPTS.generateFinalMessage(sessionData);</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const finalMessage = await callGeminiAPI(prompt);</p>
<p class="p1"><span class="Apple-converted-space">                </span>await typewriter(DOMElements.finalThankYou.text, finalMessage);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error generating final message:", e);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.finalThankYou.text.textContent = "Thank you for playing!\n\nYour participation has been recorded. Thank you for contributing to the future of ethical AI at the CHI conference.";</p>
<p class="p1"><span class="Apple-converted-space">            </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.finalThankYou.loadingBar.classList.remove('is-loading');</p>
<p class="p1"><span class="Apple-converted-space">                </span>triggerTheEndAnimation();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function triggerTheEndAnimation() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const endElement = DOMElements.finalThankYou.theEndText;</p>
<p class="p1"><span class="Apple-converted-space">            </span>endElement.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>await typewriter(endElement, "The End", 150);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function saveSessionToFirestore() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!db) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Firestore is not initialized, skipping save.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const docRef = doc(db, `artifacts/${CONFIG.APP_ID}/public/data/sessions`, gameState.currentSessionId);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const sessionData = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>userId: gameState.userId,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedPersona: gameState.selectedPersona,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>answers: gameState.answerLog,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>scores: gameState.scores,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>finalChoice: gameState.finalChoice || null,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>timestamp: new Date(),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>ethicalConclusion: gameState.ethicalConclusion,</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">                </span>await setDoc(docRef, sessionData, { merge: true });</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log(`Session ${gameState.currentSessionId} saved to Firestore.`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error writing session to Firestore:", error);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function initializeEventListeners() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.start.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>await Tone.start();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>soundEnabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>soundEnabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(soundEnabled) clickSound.triggerAttackRelease("C4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>showScreen('personaSelection');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.personaSelect.forEach(button =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>button.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (soundEnabled) clickSound.triggerAttackRelease("C4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startQuiz(e.currentTarget.dataset.persona);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.plotTwistReveal.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(soundEnabled) clickSound.triggerAttackRelease("G4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>showScreen('finalChoice');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.red.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(soundEnabled) clickSound.triggerAttackRelease("C5", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>handleFinalChoice(e.currentTarget.dataset.choice, e.currentTarget);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.black.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>if(soundEnabled) clickSound.triggerAttackRelease("C5", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>handleFinalChoice(e.currentTarget.dataset.choice, e.currentTarget);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.restartFromWorld.addEventListener('click', initializeGame);</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.getTicketFromWorld.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(soundEnabled) clickSound.triggerAttackRelease("A4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>showDebriefTicket();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.scoresContainer.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(soundEnabled) clickSound.triggerAttackRelease("E4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.ticket.scoresDetails.classList.toggle('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.scoresContainer.addEventListener('keydown', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (e.key === 'Enter' || e.key === ' ') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if(soundEnabled) clickSound.triggerAttackRelease("E4", "8n");</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.ticket.scoresDetails.classList.toggle('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.ticket.codeInput.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.buttons.completeProcess.disabled = e.target.value !== '0661';</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.completeProcess.addEventListener('click', completeProcess);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.buttons.back.addEventListener('click', handleBackButton);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.addEventListener('DOMContentLoaded', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>await initializeFirebaseAndAuth();</p>
<p class="p1"><span class="Apple-converted-space">            </span>initializeEventListeners();</p>
<p class="p1"><span class="Apple-converted-space">            </span>initializeGame();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
<p class="p2"><br></p>
</body>
</html>
